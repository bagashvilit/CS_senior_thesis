# Commit message generation

This project provides the source code to replicate the experiemntal study of my senior thesis

## Installation

- clone the repository with SSH or HTTPS

    SSH: `git@github.com:bagashvilit/CS_senior_thesis.git`
    HTTPS: `https://github.com/bagashvilit/CS_senior_thesis.git`

- configure CoRec for text similarity analysis
    The text similarity scores used in this project are implemented by [Wang et al](https://xin-xia.github.io/publication/tosem212.pdf). To use this text similarity score implementaion, please download the [CoRec.zip](https://zenodo.org/record/3828107#.Xr4DfRMzbWc) provided by the original authors.

    Once you unzip the contents please place `CoRec` directory in `./experiments` directory. Your repository should look like this

    ```
    > experiments
        > CoRec
            > __MACOSX
            > CoRec
        > experiments
        > tests
        > pyproject.toml
    > README.md
    ```

- Install Poetry for dependecy managment. Please follow the installation guide on the official [website](https://python-poetry.org/)
    If you do not want to use poetry, please manually install all the dependencies in `pyproject.toml`

- run the following command to automatically install all the project dependencies with poetry:
    `poetry install`

## Automated testing

- To run the test suite first navigate to `experiments/experiments/tests/`

- Run `poetry run pytest`

    The expected output

    ```
    collected 7 items                                                                                          

    test_experiments.py .......                                                                          [100%]

    ============================================ 7 passed in 0.15s =============================================

    ```

## Run

This repository has a file located at `experiments/experiments/data/copynet.msg`. This file contains commit messages generated by trained CopNet. To run the experiments such as text similarity scores, low frequency and Out of vocabulary word analysis, you can simply reuse the pre-generated messages. This does not require any GPU or Colab usage. Experiments can be run on CPU.

To run the experiments first navigate to `experiments/experiments`

### Text similarity score analysis for commit messages generated by CopyNet and CoRec

Please run the following command: `poetry run evaluate similarity`

The expected output:

```
CoRec Meteor:  0.15295568905411266 CoRec Rouge:  0.30305600353102213
CopyNet Meteor:  0.13257637333272335 CopyNet Rouge:  0.25268141589341003

Man-Whitney U statistical test results for ROUGE scores
        U-val alternative     p-val       RBC      CLES
MWU  3262867.0   two-sided  0.094596 -0.026795  0.513397

Man-Whitney U statistical test results for Meteor scores
        U-val alternative     p-val       RBC      CLES
MWU  3123647.0   two-sided  0.290307  0.017016  0.491492
    ```

The output shows the METEOR and ROUGE-L scores for commit messages generated by CoRec and CopyNet. The result also shows the statistical test results, such as p-value and effect size(CLES). After running this command the boxplots for the text simialrity scores distribution will be saved in `experiments/experiments/plots`.
```

### Count of low frequency and Out of Vocabulary(OOV) words

Please run the following command: `poetry run evaluate count`

The expected output:

```
Count of correctly predicted low frequency words
Count of low frequency words in reference messages:  2064
Count of low frequency words by CopyNet:  367
Count of low frequency words by CoRec:  316

Count of correctly predicted oov words
Total count of oov words in reference messages:  1003
Count of low frequency words by CopyNet:  156
Count of low frequency words by CoRec:  0
```

The output shows the total number of low frequency/OOV words in reference messages with respect to the training vocabulary. The results also shwos the number of correctly predicted low frequency/OOV words by CoRec and CopyNet.

### Text similarity analysis for commit messages that contain low frequency words

Please run the following command: `poetry run evaluate similarity --low`

The expected output:

```
CoRec Meteor:  0.13357018740474938 CoRec Rouge:  0.27036415669349745
CopyNet Meteor:  0.12106817904517164 CopyNet Rouge:  0.24148867288795195

Man-Whitney U statistical test results for ROUGE scores
        U-val alternative     p-val       RBC      CLES
MWU  969775.0   two-sided  0.454778  0.016064  0.491968

Man-Whitney U statistical test results for Meteor scores
        U-val alternative     p-val       RBC      CLES
MWU  919747.5   two-sided  0.001957  0.066822  0.466589
```

The output shows the METEOR and ROUGE-L scores for commit messages generated by CoRec and CopyNet. The result also shows the statistical test results, such as p-value and effect size(CLES). After running this command the boxplots for the text simialrity scores distribution will be saved in `experiments/experiments/plots`. Please note that the prior boxplots will be overwriten.


### Guide to re-train CopyNet and generate commit messages from scratch

In this study the model was trained in [Google Colab](https://colab.research.google.com/). To recreate the training environment please follow the steps below:

- Copy the contents of `train/copy_only.ipynb` to your own Colab notebook

- Add training, validation and test datasets to your google drive

- Enable GPU from `Edit > Notebook settings > Hardware accelerator(select GPU)` (Please note that I ran the experiments on Colab pro. The regular Colab GPU session is usually short, meaning that the session might get disconnected suddenly. The model can be trained on CPU wich is more stable but takes longer time)

- Run the entire notebook
